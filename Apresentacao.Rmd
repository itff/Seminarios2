---
title: "Modelagem Conjunta de Dados Longitudinais e de Sobrevivência"
author: 
- Ítalo Ferreira Fernandes
- Ruy Azevedo Cota Vasconcelos
date: "Universidade Federal de Minas Gerais (UFMG)"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo=FALSE}
library(knitr)
```


```{r, echo=FALSE}
caminho_img <- function(figura) paste0(getwd(),"/figuras/",figura)
```


# Introdução

<!-- Esse trabalho foi feito por mim, Ítalo, e pelo Ruy, e orientado pela Juliana. 
Falaremos sobre o artigo 'Basic Concepts and Methods for Joint Models of Longitudinal and Survival Data' escrito por Joseph Ibrahim, Haitao Chu, and Liddy Chen 
-->

## Dado de tempo até o evento

 * O tempo até o evento é o dado primordial da análise de sobrevivência. 
 
 * Importante o tempo que levou para ocorrer o evento.

 * Comparação de pacientes.
 
 * Retorna a função de riscos e razão de chances.

<!-- Na análise de sobrevivência queremos comparar o tempo até o evendo de um paciente com tratamento do paciente sem tratamento ou com um tratamento diferente, por isso o dado de tempo até o evento é muito importante aqui. Essa modelagem nos permite calcular a razão de chances que compara os grupos falando qual grupo tem uma maior chance do evento ocorrer em determinado tempo. -->
 

## Dado longitudinal

 * COleta em diferentes pontos no tempo.
 
 * Importante o valor coletado e o tempo que foi coletado.
 
 * Podem ser otimos preditores para o tempo até o evento.
 
<!-- 
Um dado pode ser considerado longitudinal quando coletamos ele em diferentes pontos no tempo. 
O importante para os moelos que utilizam esses dados é o valor observado em determinado tempo e em ensaios clínicos, esses valores observados podem influenciar o dado de tempo até o evento.
-->

## Modelo conjunto

 * Modelos clássicos não levam em conta a dependência entre essas dois tipos de dados. 

 * A modelagem conjunta foi proposta com objetivo de levar em consideração essa dependência.
 
 * Estimativas mais eficientes e menos viesadas.
 
 * Aumento no poder e redução da amostragem.

 * Propriedades demonstradas no *Chen et al*, além de serem demonstradas aqui também.

<!-- Então como os modelos classicos como o modelo linear misto para dados longitudinais e o modelo de riscos proporcionais de Cox para análise de sobrevivência não levam em conta a dependência entre essas dois tipos de dados, O artigo propõe uma modelagem conjunta para levar em conta essa dependência.
Por tanto, se existir uma influência do dado longitudinal no tempo do evento, essa modelagem produzira estimativas mais eficientes para o efeito da tratamento no tempo até o evento e para o efeito da tratamento dos marcadores longitudinais. Além de reduzir o viés da estimativa do efeito geral do tratamento.
A melhora nas estimativas implica em um aumento de poder e uma redução da amostra para o design dos ensaios clínicos.
Essas propriedades foram demonstradas no *Chen et al*, além de serem demonstradas aqui também mais a frente.
-->

# Estrutura do modelo conjunto

## Parte longitudinal

<!--
A estrutura do modelo conjunto incorpora o componente longitudinal na função de risco de Cox.
Esse componente longitudinal consiste no modelo linear misto que pode ser escrito como: ...
-->

O componente longitudinal consiste no modelo linear misto, que pode ser escrito como:

* $Y_{ij} = X_{ij} +\epsilon_{ij}$;

  * $Y_{ij}$ é a resposta observada do i-ésimo indivíduo no tempo j-ésimo;
  
  * $\epsilon_{ij}$ é o erro aleatório que assumimos que vem de uma distribuição normal;
  
  * $X_{ij}$ é conhecida como função trajetória do modelo;

##

<!--
Esse função trajetória do modelo pode ser aberta como:... 
-->

* $X_{ij} = \theta_{0i} + \theta_{1i} t_{ij} +\gamma Z_i$;
 
  * $t_{ij}$ é o valor do tempo;

  * $Z_i$ é o indicador de tratamento do i-ésimo indivíduo;
  
  * $\theta_{0i}$ e $\theta_{1i}$ são parâmetros que assumimos como aleatório e com distribuição normal multivariada.
  
  * $\gamma$ indica o efeito do tratamento no processo longitudinal. Assumimos distribuição normal com média 0 e variância desconhecida.

<!--
Esse função trajetória do modelo permite termos valores em qualquer tempo, diferente dos dados longitudinais observados que temos apenas para alguns tempos. Por exemplo, se o tempo for por dia, pode ser que tenha um dia sem dado coletado, então a função vai preencer essa lacuna.
-->

## Parte de sobrevivência

<!--
O componente de sobrevivência consiste em um modelo paramêtrico, como por exemplo, o modelo exponencial ou modelo de weibull. E para fazer o modelo conjunto, adicionamos a função trajetória do componente longitudinal a função de riscos do componente de sobrevivência. Portanto, a função de risco é escrita desse forma: ...
-->

Função de risco do modelo de sobrevivência com o componente longitudinal:

  * \(h(t) = h_o(t)exp(\beta X_{ij}+\alpha Z_i)\);
    
    * \(h(t)\) é a probabilidade do evento ocorrer até o tempo t (função de risco);
    
    * \(h_o(t)\) é a função de risco inicial.
    
    * \(\alpha\) é o efeito do tratamento no tempo até o evento;
  
    * \(\beta\) é o efeito do processo longitudinal na análise de sobrevivência.

## 

  * Três diferentes efeitos: 
  
    * \(\alpha\) é o efeito do tratamento no tempo até o evento;
    
    * \(\beta\) é o efeito do processo longitudinal na análise de sobrevivência;
    
    * \(\gamma\) é o efeito do tratamento no processo longitudinal.
  
  * Efeito geral do tratamento: 
  
    * \(\beta\gamma + \alpha\).
  
  
<!--
Temos, então, três tipos diferentes efeitos: \(\alpha\), \(\beta\) e \(\gamma\) que já falamos anteriormente, sendo que podemos juntar os três para obter o efeito geral do tratamento: \(\beta\gamma + \alpha\).

Nosso principal objetivo inferencial é estimar esses parâmetros, porque ele nos da informações importantes para a interpretação do modelo.
-->

## Interpretações dos efeitos

  * \(\beta = 0\): as observações longitudinais não têm associação com o tempo até o evento;

  * \(\beta = 0.5\): risco aumenta em 0.5 para cada unidade aumentada em \(X_ij\);

  * \(\alpha < 0\): risco de quem recebe tratamento \(Z_i = 1\) é menor de quem não recebe \(Z_i = 0\);

  * \(\gamma = 0\): o tratamento não influência a mudança dos valores dos dados longitudinais.

<!--
Portanto, falaremos a interpretação que de cada efeito traz para o modelo.
O \(\beta = 0\) significa que os dados longitudinais não tem associação com o tempo até o evento. Quer dizer que os dados longitudinais não alteram o risco, portanto, não precisa-se de modelo conjunto neste caso. 
O \(\beta = 0.5\) significa que o risco aumenta em 0.5 para cada unidade aumentada na função trajetória (X_ij) que qualquer grupo de tratamento.
Se \(\alpha\) for negativo, o risco de quem recebe tratamento é menor de quem não recebe, portanto, há indícios de que o tratamento seja eficiente. se for positivo acontece o contrário.
Se \(\gamma = 0\) significa que que o tratamento não influência na mudança dos valores dos dados longitudinais.

Agora passaremos para o Ruy monstrar alguns exemplos que podem utilizar o modelo conjunto.
-->

# Exemplos 
## Exemplos| 
 - Quality-of-Life (QDV)
 - E1193
 - Simulação

## QDV

* Caracterização da associação entre tempo até o evento e QDV atravéz modelamento conjunto.

* Entender a troca entre QDV e sobrevivência.

  * Uma certo tratamento pode prolongar a sobrevivência, mas a qualidade de vida nesse período prolongado pode ser ruim.

## Análise do modelo conjunto de _E1193_

* Experimento em grupo E1193 - Eastern Cooperative Oncology

* Examinar a associação entre QDV e tempo de sobrevivência médio para pacientes no estudo.

* Estudo clínico de fase III de doxorubicin, paclitaxel e uma combinação dos dois como tratamento quemoterápico de ponta contra câncer de mama metastático.

## _E1193_

* Pacientes que recebiam um dos dois tratamentos "simples" - doxorubicin ou paclitaxel apenas - trocaram para o outro agente durante o estudo.

* QDV foi acessada por uma escala de avaliação de terapia de câncer de mama. (Brady et al)

* Essa avaliação inclui cinco subescalas gerais - Física, social, relacionamento com o médico, emocional e funcional.

* Assim com subescalas específicas para câncer de mama.

## _E1193_

* Pontuação máxima de 148 pontos;

  * Quanto maior a pontuação, melhor a qualidade de vida do paciente.
  
* Análise do tempo de sobrevivência após entrar na fase de cross-over (progressão da doença) e associação entre tratamento e QDV;

  * QDV medida em 2 pontos durante essa fase.
  
## _E1193_

* 252 pacientes tiveram pelo menos uma medição de QDV realizada.

* 124 pacientes: paclitaxel \(\rightarrow\) doxorubicin;

  * Tempo de vida mediano: 13 meses;
  
  * 2 censuras.

* 128 pacientes: doxorubicin \(\rightarrow\) paclitaxel;

  * Tempo de vida mediano: 14.9 meses;
  
  * 6 censuras.
  
  
## _E1193_

* Contudo, apenas 65% dos pacientes tiveram 2 medições de QDV realizadas;

  * Esses dados faltantes podem introduzir viés na estimativa do efeito de QDV e do tratamento;

* Dados discrepantes não foram excluídos;

* Essas escolhas foram feitas devido a confiança na habilidade do modelo conjunto em reduzir o viés proveniente de dados incompletos ou com erro.

## _E1193_

* Função de trajetória

  - Muito ruído
  
  - tratar como aleatórias
  
* Modelos

  * Modelo de Cox apenas com a covariável do tratamento

  * Modelo de dois estágios com as duas medidas de QDV

  * Modelo conjunto para examinar o efeito do tratamento e a associação entre QDV e a sobrevivência.

## _E1193_: Suposições

* A trajetória de QDV é uma função linear do tempo
  
  - Já que temos apenas 2 medidas de QDV
  
* A transformação \(QDV^{\frac{1}{2}}\) é normal.

* A interação entre tratamento e tempo foi testada separadamente e foi não-significativa.

  - Podemos assumir que \(QDV^{\frac{1}{2}}\) segue uma trajetória da forma \(\theta_{0i} + \theta_{1i}t + \gamma Tratamento\)
    - No modelo de dois estágios e no modelo conjunto.

##

```{r fig.align="center"}
knitr::include_graphics(caminho_img("tabela1.png"))
```

##

```{r fig.align="center"}
knitr::include_graphics(caminho_img("tabela2.png"))
```

##

```{r fig.align="center"}
knitr::include_graphics(caminho_img("tabela3.png"))
```

##

```{r fig.align="center"}
knitr::include_graphics(caminho_img("figura1.png"))
```

##

```{r fig.align="center"}
knitr::include_graphics(caminho_img("figura2.png"))
```

## Simulação

## Conclusão

## Referência

  * Joseph G. Ibrahim, Haitao Chu, and Liddy M. Chen: *Basic Concepts and Methods for Joint Models of Longitudinal and Survival Data.* 